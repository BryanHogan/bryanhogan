---
import Layout from "./Layout.astro";
import TextSectionWithSide from "./TextSectionWithSide.astro";
import Button from "../components/Button.astro";

const lastUpdate: Date = new Date("2024-05-01T12:27:11Z"); // ISO Time 8601

const GITHUB_TOKEN = import.meta.env.GITHUB_TOKEN;
const OWNER = 'BryanHogan';
const REPO = 'bryanhogan';
const FILE_PATH = 'src/pages/index.astro';

async function getLastModifiedDate() {
  const url = `https://api.github.com/repos/${OWNER}/${REPO}/commits?path=${FILE_PATH}&page=1&per_page=1`;
  
  const response = await fetch(url, {
    headers: {
      'Authorization': `token ${GITHUB_TOKEN}`,
      'Accept': 'application/vnd.github.v3+json'
    }
  });

  if (!response.ok) {
    throw new Error(`GitHub API request failed: ${response.statusText}`);
  }

  const data = await response.json();
  
  if (data.length > 0) {
    const lastCommitDate = new Date(data[0].commit.committer.date);
    return lastCommitDate.toLocaleDateString();
  }
  
  return 'Unknown';
}

const lastModified = await getLastModifiedDate();
---

<Layout
    title="Now - Bryan Hogan"
    metaDescription="About BryanHogan.com & Bryan Hogan."
    headerMode="All"
>
    <div class="gradient-background small-intro-section" style="">
        <div class="text-section text-align-center text-shadow">
            <h1>Now</h1>
            <p class="text-align-center" style="margin-inline: auto;">
                Last updated <time datetime={lastUpdate.toISOString()}></time>
                {
                    new Date(lastUpdate).toLocaleDateString(undefined, {
                        year: "numeric",
                        month: "long",
                        day: "numeric",
                    })
                }<br />from my home in Cologne.
            </p>
            <p>Text: {lastModified}</p>
        </div>
    </div>
    <TextSectionWithSide>
        <h2
            class="text-align-center accent-underline-adjust-width"
            id="doing-now"
            slot="h2-title"
        >
            What am I doing now?
        </h2>
        <slot />
        <nav slot="aside-content">
            <Button
                text="Blog"
                link="/blog"
                buttonStyle="transparent-bright small grow color-accent"
            />
        </nav>
    </TextSectionWithSide>
</Layout>
<style></style>
